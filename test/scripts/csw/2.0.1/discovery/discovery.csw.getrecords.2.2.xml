<?xml version="1.0" encoding="UTF-8"?>
<ctl:package
 xmlns="http://www.occamlab.com/ctl"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ctl="http://www.occamlab.com/ctl"
 xmlns:parsers="http://www.occamlab.com/te/parsers"
 xmlns:myparsers="http://www.galdosinc.com/myparsers"
 xmlns:saxon="http://saxon.sf.net/"
 xmlns:csw="http://www.opengis.net/cat/csw"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.occamlab.com/ctl ../../../../../apps/engine/resources/com/occamlab/te/schemas/ctl.xsd">

	<test name="csw:discovery.csw.getrecords.2.2">
      <param name="VAR_CSW_GET_RECORDS_HTTP_POST_URL"/>
      <assertion>If resultType is 'results' then must return any matching records, up to the max number of hits number in the SearchResults element.</assertion>
      <comment>This test issues a GetRecords request using HTTP POST to the CSW server under test. The resultType is 'results' and should respond with the usual SearchResults, with no more results than the specified hits number (3).</comment>
      <link>OGC 04-021r3, 10.8.4.2, p. 135</link>
		<code>
		
			<!--TODO: Are there 3 records for sure?-->
		
			<xsl:variable name="request1">
				<request>
					<url>
						<xsl:value-of select="$VAR_CSW_GET_RECORDS_HTTP_POST_URL"/>
					</url>
					<method>post</method>
					<body><![CDATA[
<csw:GetRecords outputSchema="http://www.opengis.net/cat/csw" xmlns:csw="http://www.opengis.net/cat/csw" resultType="results" maxRecords="3">
	<csw:Query typeName="csw:Record"/>
</csw:GetRecords>
					]]></body>
					<!--<myparsers:XMLValidatingParser.CSW/>-->
				</request>
			</xsl:variable>
			
			<xsl:if test="not($request1/*)">
				<ctl:fail/>
			</xsl:if>

			<xsl:if test="$request1/*">
				<xsl:variable name="expression">count(//csw:GetRecordsResponse/csw:SearchResults/*) &lt;= 3</xsl:variable>
				<ctl:call-test name="ctl:assert-xpath">
					<ctl:with-param name="expr" select="$expression"/>
					<ctl:with-param name="doc" select="$request1"/>
				</ctl:call-test>
			</xsl:if>
				
		</code>
	</test>
</ctl:package>
