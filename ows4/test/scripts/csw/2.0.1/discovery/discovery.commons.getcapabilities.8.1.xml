<?xml version="1.0" encoding="UTF-8"?>
<ctl:package
 xmlns="http://www.occamlab.com/ctl"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ctl="http://www.occamlab.com/ctl"
 xmlns:parsers="http://www.occamlab.com/te/parsers"
 xmlns:myparsers="http://www.galdosinc.com/myparsers"
 xmlns:saxon="http://saxon.sf.net/"
 xmlns:csw="http://www.opengis.net/cat/csw"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.occamlab.com/ctl ../../../../../apps/engine/resources/com/occamlab/te/schemas/ctl.xsd">

	<test name="csw:discovery.commons.getcapabilities.8.1">
      <param name="VAR_CSW_GET_CAPABILITIES_HTTP_GET_URL"/>
      <assertion>If the the server recognizes the UpdateSequence parameter, the response entity shall include the revision matching the applicable case in Table 4. The value must be incremented whenever the service metadata is changed.</assertion>
      <comment>This test issues a GetCapabilities request using HTTP GET to the CSW server under test. The UpdateSequence parameter has the value 'Any' and should result in the latest sequence of the capabilities document.</comment>
      <link>OGC 05-008c1, 7.3.4, p.18</link>
		<code>
		
			<xsl:variable name="request1">
				<request>
					<url>
						<xsl:value-of select="$VAR_CSW_GET_CAPABILITIES_HTTP_GET_URL"/>
					</url>
					<method>get</method>
					<param name="service">CSW</param>
					<param name="version">2.0.1</param>
					<param name="request">GetCapabilities</param>
					<param name="updatesequence">Any</param>
					<myparsers:XMLValidatingParser.CSW/>
				</request>
			</xsl:variable>
			
			<xsl:if test="not($request1/*)">
				<ctl:fail/>
			</xsl:if>

			<xsl:if test="$request1/*">
				<xsl:variable name="expression">//csw:Capabilities/@updateSequence='1.0'</xsl:variable>
				<ctl:call-test name="ctl:assert-xpath">
					<ctl:with-param name="expr" select="$expression"/>
					<ctl:with-param name="doc" select="$request1"/>
				</ctl:call-test>
			</xsl:if>

			<!--TODO: Set update sequence numbers on the capabilities document for theses tests to use.-->
				
		</code>
	</test>
</ctl:package>
