<?xml version="1.0" encoding="UTF-8"?>
<ctl:package
 xmlns="http://www.occamlab.com/ctl"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ctl="http://www.occamlab.com/ctl"
 xmlns:parsers="http://www.occamlab.com/te/parsers"
 xmlns:myparsers="http://www.galdosinc.com/myparsers"
 xmlns:saxon="http://saxon.sf.net/"
 xmlns:csw="http://www.opengis.net/cat/csw"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.occamlab.com/ctl ../../../../../apps/engine/resources/com/occamlab/te/schemas/ctl.xsd">

	<test name="csw:discovery.csw.getrecords.6.1">
      <param name="VAR_CSW_GET_RECORDS_HTTP_POST_URL"/>
      <assertion>The maxRecords parameter has a default value of 10. If the value is 0 then the server should react as if the 'resultType=hits' (see 10.8.4.2).</assertion>
      <comment>This test issues a GetRecords request using HTTP POST to the CSW server under test. The maxRecords is set to '0' and should respond like the resultType was 'hits', with an empty SearchResults element with the number of hits for the request.</comment>
      <link>OGC 04-021r3, 10.8.4.6, p. 136</link>
		<code>
		
			<xsl:variable name="request1">
				<request>
					<url>
						<xsl:value-of select="$VAR_CSW_GET_RECORDS_HTTP_POST_URL"/>
					</url>
					<method>post</method>
					<body><![CDATA[
<csw:GetRecords resultType="results" outputSchema="http://www.opengis.net/cat/csw" xmlns:csw="http://www.opengis.net/cat/csw" maxRecords="0">
	<csw:Query typeName="csw:Record"/>
</csw:GetRecords>
					]]></body>
					<myparsers:XMLValidatingParser.CSW/>
				</request>
			</xsl:variable>
			
			<xsl:if test="not($request1/*)">
				<ctl:fail/>
			</xsl:if>

			<xsl:if test="$request1/*">
				<xsl:variable name="expression">count(//csw:GetRecordsResponse/csw:SearchResults/*) = 0</xsl:variable>
				<ctl:call-test name="ctl:assert-xpath">
					<ctl:with-param name="expr" select="$expression"/>
					<ctl:with-param name="doc" select="$request1"/>
				</ctl:call-test>
			</xsl:if>
				
		</code>
	</test>
</ctl:package>
