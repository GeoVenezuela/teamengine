<?xml version="1.0" encoding="UTF-8"?>
<ctl:package
 xmlns="http://www.occamlab.com/ctl"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ctl="http://www.occamlab.com/ctl"
 xmlns:parsers="http://www.occamlab.com/te/parsers"
 xmlns:myparsers="http://teamengine.sourceforge.net/parsers"
 xmlns:saxon="http://saxon.sf.net/"
 xmlns:csw="http://www.opengis.net/cat/csw"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.occamlab.com/ctl ../../../../../apps/engine/resources/com/occamlab/te/schemas/ctl.xsd">

	<test name="csw:discovery.csw.getcapabilities.5">
      <param name="csw.GetCapabilities.get.url"/>
      <assertion>Must implement a Filter_Capabilities section in implementing CSW binding. Must also implement the logical And, Or, and Not; comparison PropertyIsEqualTo, PropertyIsNotEqualTo, PropertyIsLessThan, PropertyIsGreaterThan, PropertyIsLessThanOrEqualTo, PropertyIsGreaterThanOrEqualTo, and PropertyIsLike; spatial BBOX operators.</assertion>
      <comment>This test issues a GetCapabilities request using HTTP GET to the CSW server under test. A capabilities document is expected, with all mandatory values listed in the CSW specification.  If all the required elements are present in the document then the test is valid, otherwise it fails.</comment>
      <link>OGC 04-021r3, 10.5.2, p. 121</link>
		<code>
		
			<xsl:variable name="request1">
				<request>
					<url>
						<xsl:value-of select="$csw.GetCapabilities.get.url"/>
					</url>
					<method>get</method>
					<param name="service">http://www.opengis.net/cat/csw</param>
					<param name="version">2.0.1</param>
					<param name="request">GetCapabilities</param>
					<!--<myparsers:XMLValidatingParser.CSW/>-->
				</request>
			</xsl:variable>
			
			<xsl:if test="not($request1/*)">
				<ctl:fail/>
			</xsl:if>

			<xsl:if test="$request1/*">
				<xsl:variable name="expression">//csw:Capabilities</xsl:variable>
				<ctl:call-test name="ctl:assert-xpath">
					<ctl:with-param name="expr" select="$expression"/>
					<ctl:with-param name="doc" select="$request1"/>
				</ctl:call-test>
			</xsl:if>
				
		    <xsl:if test="$request1/*">
				<ctl:call-test name="ctl:SchematronValidatingParser">
					<ctl:with-param name="doc" select="$request1"/>
					<ctl:with-param name="schematronFile">sch/csw/2.0.1/CSWCapabilities.sch</ctl:with-param>
					<ctl:with-param name="phase">AllCSWRequiredElements</ctl:with-param>
				</ctl:call-test>				
			</xsl:if>						
				
		</code>
	</test>
</ctl:package>
