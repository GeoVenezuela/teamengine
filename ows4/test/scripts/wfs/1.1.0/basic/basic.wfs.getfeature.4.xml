<?xml version="1.0" encoding="UTF-8"?>
<ctl:package
 xmlns="http://www.occamlab.com/ctl"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ctl="http://www.occamlab.com/ctl"
 xmlns:parsers="http://www.occamlab.com/te/parsers"
 xmlns:myparsers="http://www.galdosinc.com/myparsers"
 xmlns:saxon="http://saxon.sf.net/"
 xmlns:wfs="http://www.opengis.net/wfs"
 xmlns:xi="http://www.w3.org/2001/XInclude"
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.occamlab.com/ctl ../../../../../apps/engine/resources/com/occamlab/te/schemas/ctl.xsd">

	<test name="wfs:basic.wfs.getfeature.4">
      <param name="VAR_WFS_GET_FEATURE_HTTP_POST_URL"/>
      <assertion>The @traverseXlinkDepth and @traverseXlinkExpiry attributes shall be ignored if the service does not implement the WFS-XLink conformance class.</assertion>
      <comment>This test issues a GetFeature request using HTTP POST to the WFS server under test. There are values set for the traverseXlinkDepth and traverseXlinkExpiry which will be used if the server supports them, and will be ignored otherwise, resulting in a valid response.</comment>
      <link>OGC 04-094, 9.1, p.33</link>
		<code>
		
			<xsl:variable name="request1">
				<request>
					<url>
						<xsl:value-of select="$VAR_WFS_GET_FEATURE_HTTP_POST_URL"/>
					</url>
					<method>post</method>
				    <body><![CDATA[
				    <wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" version="1.1.0" service="WFS" traverseXlinkDepth="*" traverseXlinkExpiry="3">
					    <wfs:Query xmlns:sf="http://www.opengis.net/cite/gmlsf" typeName="sf:SimplePointFeature" />
				    </wfs:GetFeature>
				    ]]>
					</body>
					<myparsers:XMLValidatingParser.WFS/>
				</request>
			</xsl:variable>
			
			<xsl:if test="not($request1/*)">
				<ctl:fail/>
			</xsl:if>

			<xsl:if test="$request1/*">
				<xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
				<ctl:call-test name="ctl:assert-xpath">
					<ctl:with-param name="expr" select="$expression"/>
					<ctl:with-param name="doc" select="$request1"/>
				</ctl:call-test>
			</xsl:if>
				
		</code>
	</test>
</ctl:package>
