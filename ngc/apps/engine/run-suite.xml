<project name="run-suite" basedir="." default="test">
	<description>Executes a test suite</description>
	
	<!-- ets.base.dir refers to base directory of executable test suite, below
         which is the main package (ctl/main.ctl).
         e.g. ets.base.dir = /some/path/csw/2.0.1/ets
    -->
	<!-- Load property overrides from user home -->
    <property file="${user.home}/${ant.project.name}.properties"/>
	
	<property name="lib.dir" value="${basedir}/lib"/>
	<property name="dist.dir" value="${basedir}/dist"/>
	<property name="engine.resource.dir" value="${basedir}/resources"/>
	<property name="ets.resources.dir" value="${ets.base.dir}/resources"/>
	
	<target name="test" if="ets.base.dir" 
        description="Runs the test suite located using the ets.base.dir property">
		<java classname="com.occamlab.te.Test" fork="true" 
              jvm="${java.dir}/bin/java.exe" 
              maxmemory="512m">
			<env key="JAVA_HOME" value="${java.dir}"/>
            <arg value="-mode=test"/>
            <arg value="-logdir=logs"/>
            <arg value="-source=${ets.base.dir}/ctl/main.xml"/> <!-- .ctl or .xml or just the directory ".../.../" -->
			<classpath>
				<fileset dir="${lib.dir}">
					<include name="**/*.jar"/>
				</fileset>
				<fileset dir="${dist.dir}">
					<include name="**/*.jar"/>
				</fileset>
				<pathelement path="${engine.resource.dir}"/>
				<pathelement path="${ets.base.dir}"/>
				<pathelement path="${ets.resources.dir}"/>
			</classpath>
		</java>
	</target>

	<target name="docmode" if="ets.base.dir" 
        description="Documents the test suite located using the ets.base.dir property">
		<java classname="com.occamlab.te.Test" fork="true" 
              jvm="${java.dir}/bin/java.exe" 
              maxmemory="512m">
			<env key="JAVA_HOME" value="${java.dir}"/>
            <arg value="-mode=doc"/>
            <arg value="-source=${ets.base.dir}/ctl/main.xml"/>
			<classpath>
				<fileset dir="${lib.dir}">
					<include name="**/*.jar"/>
				</fileset>
				<fileset dir="${dist.dir}">
					<include name="**/*.jar"/>
				</fileset>				
				<pathelement path="${engine.resource.dir}"/>
				<pathelement path="${ets.base.dir}"/>
				<pathelement path="${ets.resources.dir}"/>
			</classpath>
		</java>
	</target>
	
	<target name="listsuites" if="ets.base.dir" 
      description="Lists the suites in a ctl test file">
		<java classname="com.occamlab.te.ListSuites" fork="true" jvm="${java.dir}/bin/java.exe">
			<env key="JAVA_HOME" value="${java.dir}"/>
            <arg value="-source=${ets.base.dir}/ctl/main.xml"/>
			<classpath>
				<fileset dir="${lib.dir}">
					<include name="**/*.jar"/>
				</fileset>
				<fileset dir="${dist.dir}">
					<include name="**/*.jar"/>
				</fileset>				
				<pathelement path="${engine.resource.dir}"/>
				<pathelement path="${ets.base.dir}"/>				
				<pathelement path="${java.class.path}"/>
				<pathelement path="${basedir}"/>				
			</classpath>
		</java>
	</target>
	
	<target name="viewlog" if="session.id" 
      description="Views the log results from a test run (session)">
		<java classname="com.occamlab.te.ViewLog" fork="true" 
            jvm="${java.dir}/bin/java.exe">
			<env key="JAVA_HOME" value="${java.dir}"/>
            <arg value="-logdir=logs"/>
            <arg value="-session=${session.id}"/>
			<classpath>
				<fileset dir="${lib.dir}">
					<include name="**/*.jar"/>
				</fileset>
				<fileset dir="${dist.dir}">
					<include name="**/*.jar"/>
				</fileset>				
				<pathelement path="${engine.resource.dir}"/>
				<pathelement path="${java.class.path}"/>
				<pathelement path="${basedir}"/>
			</classpath>
		</java>
	</target>
	
</project>
