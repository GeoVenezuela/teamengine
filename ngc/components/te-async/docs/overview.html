<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Asynchronous module - Overview</title>
</head>
<body>
<h2>Asynchronous module</h2>
<p>
The Asynchronous module provides functions for validating the behaviour of
asynchronous request processing.
</p>

<p>The following functions are defined in the <code>te-async</code> package. The
"tef" prefix denotes the "xmlns:tef="http://teamengine.sourceforge.net/functions"
namespace.
</p>

<p>Also note that the callback.url in the example would be the value of the home
element in the config.xml file (see the &lt;ctl:get-home> built-in method) appended
with "/callback/html".</p>

<h4>tef:executeAsyncRequest</h4>
<pre>
    &lt;ctl:function name="tef:executeAsyncRequest">
		&lt;ctl:param name="request">The asnychronous request element (XML).&lt;/ctl:param>
        	&lt;ctl:return>The responses from the server (initial acknowledgement and the final response) in an XML response container.&lt;/ctl:return>
		&lt;ctl:description>Sends an asynchronous request to a remote URL and listens on a local servlet
		(deployed in the engine web servlet container) for the final response.&lt;/ctl:description>
		&lt;ctl:java class="net.sf.teamengine.async.AsyncManager"
                  method="executeAsyncRequest"/>
    &lt;/ctl:function>
</pre>

<h3>Examples</h3>

<h4>Example Requests</h4>
<pre>
&lt;ctl:call-function name="tef:executeAsyncRequest">
  &lt;ctl:with-param name="request">
    &lt;ctl:async-request
	port="80"
	timeout="30"
	xpointer-id="'xmlns(csw=http://www.opengis.net/cat/csw/2.0.2)xpointer(//csw:RequestId)'">
	  &lt;ctl:url>&lt;xsl:value-of select="$harvest.url"/>&lt;/ctl:url>
	  &lt;ctl:method>POST&lt;/ctl:method>
	  &lt;ctl:body>
	    &lt;csw:Harvest
	    xmlns:csw="http://www.opengis.net/cat/csw/2.0.2"
	    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	    service="WRS" version="1.0.0">
	      &lt;Source>&lt;xsl:value-of select="$source.url"/>&lt;/Source>
	      &lt;ResourceType>urn:x-ogc:specification:csw-ebrim:Document&lt;/ResourceType>
	      &lt;ResourceFormat>application/xml&lt;/ResourceFormat>
	      &lt;ResponseHandler>&lt;xsl:value-of select="$callback.url"/>&lt;/ResponseHandler>
	    &lt;/csw:Harvest>
	  &lt;/ctl:body>
    &lt;/ctl:async-request>
  &lt;/ctl:with-param>
&lt;/ctl:call-function>
</pre>

OR

<pre>
&lt;xsl:variable name="request">
  &lt;ctl:async-request
	port="80"
	timeout="30"
	xpointer-id="'xmlns(csw=http://www.opengis.net/cat/csw/2.0.2)xpointer(//csw:RequestId)'">
	  &lt;ctl:url>&lt;xsl:value-of select="$harvest.url"/>&lt;/ctl:url>
	  &lt;ctl:method>POST&lt;/ctl:method>
	  &lt;ctl:body>
	    &lt;csw:Harvest
	    xmlns:csw="http://www.opengis.net/cat/csw/2.0.2"
	    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	    service="WRS" version="1.0.0">
	      &lt;Source>&lt;xsl:value-of select="$source.url"/>&lt;/Source>
	      &lt;ResourceType>urn:x-ogc:specification:csw-ebrim:Document&lt;/ResourceType>
	      &lt;ResourceFormat>application/xml&lt;/ResourceFormat>
	      &lt;ResponseHandler>&lt;xsl:value-of select="$callback.url"/>&lt;/ResponseHandler>
	    &lt;/csw:Harvest>
     &lt;/ctl:body>
  &lt;/ctl:async-request>
&lt;/xsl:variable>

&lt;xsl:variable name="responses">
  &lt;ctl:call-function name="tef:executeAsyncRequest($request)">
&lt;xsl:variable name="responses">
</pre>

<h4>Example Responses</h4>
<pre>
&lt;content>
  &lt;csw:HarvestResponse xmlns:csw="http://www.opengis.net/cat/csw/2.0.2">
   &lt;csw:Acknowledgement timeStamp="2007-08-05T17:12:42-07:00">
    &lt;csw:EchoedRequest/>
    &lt;csw:RequestId>mid:acknowledgement-1@galdosinc.com&lt;/csw:RequestId>
   &lt;/csw:Acknowledgement>
  &lt;/csw:HarvestResponse>
&lt;/content>
&lt;content>
  &lt;csw:HarvestResponse xmlns:csw="http://www.opengis.net/cat/csw/2.0.2">
   &lt;csw:TransactionResponse>
    &lt;csw:TransactionSummary requestId="mid:acknowledgement-1@galdosinc.com">
     &lt;csw:totalInserted>1&lt;/csw:totalInserted>
    &lt;/csw:TransactionSummary>
   &lt;/csw:TransactionResponse>
  &lt;/csw:HarvestResponse>
&lt;/content>
</pre>

</body>
</html>